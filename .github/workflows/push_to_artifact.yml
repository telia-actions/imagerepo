name: Deploy Docker Image to JFROG Artifactory
on: 
  - workflow_dispatch

env:
  JF_USER: ${{ secrets.JF_USER }}
  JF_PASSWORD: ${{ secrets.JF_PASSWORD }}
  ARTIFACTORY_READER_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
  ARTIFACTORY_READER_TOKEN: ${{ secrets.DOCKERHUB_TOKEN}}
jobs:
  build:
    runs-on: ubuntu-latest

    steps:
	- name: Checkout code
        uses: actions/checkout@v3
    - name: Checkout code
      uses: actions/checkout@v2
	- name: Login to Docker Hub
      uses: docker/login-action@v2
      with:
        username: ${{ env.ARTIFACTORY_READER_USERNAME }}
        password: ${{ env.ARTIFACTORY_READER_TOKEN }}
    - name: Pull Docker image
      run: |
        docker pull nginx:alpine
	 

    - name: Retag Docker image
      run: |
        docker tag nginx:alpine tfpt-managed-base-docker-images/nginx:alpine

    - name: Login to JFROG Artifactory
      run: |
        echo "$JF_PASSWORD" | docker login --username "$JF_USER" --password-stdin https://jfrog.teliacompany.io/artifactory/tfpt-managed-base-docker-images/

    - name: Push Docker image
      run: |
        docker push tfpt-managed-base-docker-images/nginx:alpine
